![image-20231030092224193](https://mlbzdx.oss-cn-chengdu.aliyuncs.com/image-20231030092224193.png)

Node 中有多个线程，但运行`js`的只有一个线程。

Node 开始运行时首先会从入口文件开始调用 `main` 函数

检查是否进入事件循环 `event loop`，即判断是否需要等待其他线程任务完成或者线程内仍有任务需要完成。如果有，进入事件循环，循环结束后继续判断是否进入事件循环，直到线程内的所有任务或其他线程的任务都被执行完毕，跳出事件循环。

在 `node.js`中，存在类似于浏览器中队列的概念，但区别于浏览器中的微队列和宏队列，一共存在六个队列，这里着重注意

`timer` ， `poll` ，`check`。

* `timer` ：计时阶段，计时函数 `setTimeout`，`setInterval` 等回调函数都会进入该队列进行执行，计时完成后将其内容清空
* `poll`：除了 `timer` 和 `check` ，绝大多数的回调函数都会进入该队列，如文件的读取，监听用户请求等。如果 `poll` 中有回调，会一次执行回调，直到清空队列；如果 `poll`中没有回调，会等待其他队列中出现回调，结束该阶段，进入下一阶段；如果其他队列中也没有回调，持续等待，直到出现回调为止。
* `check`：检查阶段，使用 `setImmediate` 会直接进入该队列

事件循环每次执行回调函数之前，必须先清空 `nextTick` 或者 `promise`

* `nextTick` ，不属于事件循环，类似于微队列，优先级最高。
* `promise`，不属于事件循环，类似于微队列，优先级仅次于 `nextTick`